{% extends "demowebsite/base.html" %}
{% load static shared_tags %}

{% block title %}{{ task_name }} experiment #{{ object.name }}-{{ object.id }}{% endblock %}

{% block content %}
<script type="text/javascript" src="{% static "js/build.js" %}"></script>

<div class="centerwrap">
    {% if request.user.is_authenticated %}
        <p class="breadcrumbs">
            <a href="{% url app_name|add:':list' %}">&lt; all {{ task_name }} experiments</a>
        </p>
    {% endif %}

    <h1>{{ task_name }} <span class="id-main">{{ object.name }}-{{ object.id|uuid_prefix }}</span><span class="id-suffix">{{ object.id|uuid_suffix }}</span></h1>
    <p>Requested by {{ object.requested_by }} on dataset
        <a href="{% url app_name|add:':list_perdataset' object.dataset.pk %}">
            <span class="id-main">{{ object.dataset.name }}-{{ object.dataset.id|uuid_prefix }}</span>
            <span class="id-suffix">{{ object.dataset.id|uuid_suffix }}</span>
        </a>
    </p>
    <p>
        {% if not object.is_finished %}
            <a href="{% url app_name|add:':cancel' object.id %}" class="btn">
                <span class="iconify" data-icon="mdi:close-circle"></span>
                <span>Cancel</span>
            </a>
        {% endif %}
        <a class="btn is-outline" href="{{ object.dataset.zip_file.url }}">
            <span class="iconify" data-icon="mdi:folder-download"></span> <span>Download dataset</span>
        </a>
        {% if object.is_finished %}
            <a href="{% url app_name|add:':delete' object.pk %}" class="btn">
                <span class="iconify" data-icon="mdi:delete"></span>
                <span>Delete this experiment</span>
            </a>
            <a href="{% url app_name|add:':restart' object.id %}" class="btn">
                <span class="iconify" data-icon="mdi:clock-start"></span>
                <span>Start new {{ task_name }} with same dataset</span>
            </a>
        {% endif %}
    </p>
    <pre>Parameters : {{ object.parameters }}</pre>

    {% if object.is_finished %}

        <p>Status: <span class="status status-{{ object.status }}">{{ object.status }}</span></p>

        {% if object.full_log %}<pre>{{ object.full_log }}</pre>{% endif %}

        {% block results %}
            {% include app_name|add:'/results.html' %}
        {% endblock %}

    {% else %}
        <div id="tracking">
            <p>Status: {{ object.status }}</p>
        </div>

        <script type="text/javascript">
            DemoTools.initProgressTracker(document.getElementById("tracking"), "{% url app_name|add:':progress' object.id %}");
        </script>
    {% endif %}
</div>
{% endblock %}
