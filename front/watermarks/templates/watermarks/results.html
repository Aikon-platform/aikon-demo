{% load static %} {% if object.status == "SUCCESS" %}
<div class="centerwrap details-wrapper detailed">
    <h3>Watermarks {{ object.analysis_type }} results</h3>

    {% if not object.dataset %}
    <div class="message mt-5">
        <div class="message-body">
            <p>Dataset was deleted</p>
        </div>
    </div>
    {% else %} 

        {% if object.analysis_type == "similarity" %}
            <div class="widen">
                <div id="matches" class="matches-viewer"></div>
            </div>

            <script type="text/javascript">
                document.addEventListener("DOMContentLoaded", () => {
                    DemoTools.initSimilarityApp(
                        document.getElementById("matches"),
                        "{{ object.similarity_task.index_url|escapejs }}",
                        "{{ object.similarity_task.similarity_matrix_url|escapejs }}",
                        "cluster"
                    );
                });
            </script>
        {% elif object.analysis_type == "indexing" %}
            <p>Indexing completed successfully</p>
            <p>
                Index built: {{ object.indexing_task.index.name }} ({{ object.indexing_task.index.public|yesno:"public,private" }})
            </p>
            <p>
                {% if editable %}<a
                    class="button is-link"
                    href="{% url 'search:index_edit' object.indexing_task.index.id %}?next={{ object.get_absolute_url }}"
                    ><span class="iconify mr-1" data-icon="mdi:pencil"></span><span>Edit</span></a
                >
                {% endif %}
                <a
                    class="button is-link"
                    href="{% url 'watermarks:start' %}?analysis_type=query&index={{ object.indexing_task.index.id }}"
                    ><span class="iconify mr-1" data-icon="mdi:search"></span
                    ><span>Search in this index</span></a
                >
            </p>
        {% elif object.analysis_type == "query" %} 
            {% if object.query_task.similarity %}
            <a href="{{ object.query_task.get_download_json_url }}" class="button is-link" download>
                <span class="iconify" data-icon="mdi:json"></span>
                <span>Download similarity matrix</span>
            </a>
            {% endif %}
            <a
                class="button is-link"
                href="{% url 'watermarks:start' %}?analysis_type=query&index={{ object.query_task.target_index.id }}"
                ><span class="iconify mr-1" data-icon="mdi:search"></span
                ><span>Start a new search</span></a
            >

            <div class="widen">
                <div id="matches" class="matches-viewer"></div>
            </div>

            <script type="text/javascript">
                document.addEventListener("DOMContentLoaded", () => {
                    DemoTools.initSearchResults(
                        document.getElementById("matches"),
                        "{{ object.query_task.target_index.index_url|escapejs }}",
                        "{{ object.query_task.result_url|escapejs }}"
                    );
                });
            </script>
        {% endif %} 

    {% endif %}
</div>
{% endif %}
